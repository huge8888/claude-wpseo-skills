# SEO WordPress Manager

Batch update Rank Math SEO metadata for WordPress posts and WooCommerce products via GraphQL API.

## Overview

This skill connects to your WordPress/WooCommerce site via WPGraphQL and enables batch updates of:
- SEO titles
- Meta descriptions
- Focus keyphrases
- Open Graph metadata

**Fully compatible with WooCommerce, Shoptimizer theme, and CommerceKit.**

## Prerequisites

### WordPress Setup

1. **Install WPGraphQL**
   ```
   Plugins → Add New → Search "WPGraphQL" → Install & Activate
   ```

2. **Install Rank Math SEO** (if not already installed)
   ```
   Plugins → Add New → Search "Rank Math SEO" → Install & Activate
   ```

3. **Install WPGraphQL for Rank Math SEO**
   - Download from: https://github.com/AxeWP/wp-graphql-rank-math
   - Or via Composer: `composer require axepress/wp-graphql-rank-math`

4. **Install WPGraphQL WooCommerce** (for product support)
   - Download from: https://github.com/wp-graphql/wp-graphql-woocommerce

5. **Enable Mutations** (add to `functions.php`):
   ```php
   // See skills/seo-wordpress-manager/SKILL.md for full code
   add_action('graphql_register_types', function() {
       register_graphql_mutation('updatePostSeo', [...]);
   });
   ```

6. **Create Application Password**
   - Users → Your Profile → Application Passwords
   - Name: "Claude SEO Manager"
   - Copy the generated password

### Configuration

Create `skills/seo-wordpress-manager/config.json`:

```json
{
  "wordpress": {
    "graphql_url": "https://your-site.com/graphql",
    "username": "your-username",
    "app_password": "xxxx xxxx xxxx xxxx"
  },
  "batch": {
    "size": 10,
    "delay_seconds": 1
  }
}
```

Or use environment variables:
```bash
WP_GRAPHQL_URL=https://your-site.com/graphql
WP_USERNAME=your-username
WP_APP_PASSWORD=xxxx xxxx xxxx xxxx
```

## Usage

### Via Claude (Recommended)

Simply describe what you want:

```
"Update meta descriptions for posts in the tutorials category"
"Fix SEO titles that are too long for WooCommerce products"
"Add focus keyphrases to products that are missing them"
"Analyze SEO scores for all products in electronics category"
```

Claude will:
1. Fetch posts/products and identify SEO issues
2. Analyze content and current SEO data
3. Generate optimized titles, descriptions, and keyphrases
4. Show you a preview of changes (before/after comparison)
5. Ask for confirmation
6. Apply changes in batches with progress tracking
7. Report results with success/failure counts

### Via Scripts (Direct)

```bash
# Test connection
python scripts/wp_graphql_client.py --action test

# Analyze posts for SEO issues
python scripts/analyze_seo.py --all --output analysis.json

# Analyze a specific category
python scripts/analyze_seo.py --category tutorials --output analysis.json

# Fetch WooCommerce products
python scripts/wp_graphql_client.py --action products --all --output products.json

# Fetch products by category
python scripts/wp_graphql_client.py --action products --category electronics --output products.json

# Check focus keyphrases too
python scripts/analyze_seo.py --all --check-keyphrase --output analysis.json

# Preview changes (requires changes.json input - generated by Claude)
python scripts/preview_changes.py --input changes.json --validate

# Apply changes (dry-run by default)
python scripts/rankmath_batch_updater.py --input changes.json

# Apply changes for real
python scripts/rankmath_batch_updater.py --input changes.json --apply

# Resume interrupted batch
python scripts/rankmath_batch_updater.py --resume --input changes.json
```

### The Workflow

```
┌─────────────────────────────────────────────────────────────────┐
│  1. ANALYZE                                                      │
│     analyze_seo.py or wp_graphql_client.py --action products    │
│     (identifies issues: missing, too long, generic, etc.)       │
└────────────────────────────┬────────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  2. GENERATE (Claude)                                           │
│     Reads analysis → generates changes.json                     │
│     (optimized titles, descriptions, keyphrases)                │
└────────────────────────────┬────────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  3. PREVIEW                                                      │
│     preview_changes.py → shows before/after                     │
│     (user reviews and confirms)                                 │
└────────────────────────────┬────────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  4. APPLY                                                        │
│     rankmath_batch_updater.py --apply → WordPress               │
│     (batch updates with progress tracking)                      │
└─────────────────────────────────────────────────────────────────┘
```

## Input Format

The batch updater expects a JSON file with this structure:

```json
{
  "updates": [
    {
      "post_id": 123,
      "post_title": "Original Post or Product Title",
      "current": {
        "seo_title": "Old Title | Site Name",
        "meta_desc": "Old description",
        "focus_keyphrase": "old keyword"
      },
      "new": {
        "seo_title": "New Optimized Title | Site Name",
        "meta_desc": "New compelling description under 160 characters",
        "focus_keyphrase": "new focus keyword"
      }
    }
  ]
}
```

## Safety Features

| Feature | Description |
|---------|-------------|
| **Dry-run by default** | Always preview before applying |
| **Confirmation prompt** | Must type "yes" to apply live changes |
| **Progress tracking** | Resume interrupted batches |
| **Backups** | Original values saved before changes |
| **Rate limiting** | Configurable delay between requests |

## SEO Best Practices

### Title Optimization
- **Length**: 50-60 characters (truncated at ~60 in SERPs)
- **Structure**: `Primary Keyword - Secondary | Brand`
- **Front-load**: Important keywords at the beginning

### Meta Description
- **Length**: 150-160 characters
- **Include CTA**: "Learn", "Discover", "Get", "Shop Now"
- **Include keyword**: Natural placement
- **Unique**: Every page needs a different description

### Focus Keyphrase
- One primary keyword per post/product
- Long-tail keywords often perform better
- Match search intent

### WooCommerce Product SEO
- Include product attributes in title (size, color, brand)
- Add pricing/value proposition in meta description
- Use product-specific schema markup
- Optimize category pages separately

## Troubleshooting

### "GraphQL request failed: 401"
- Check Application Password is correct
- Ensure username matches the WordPress user

### "GraphQL errors: updatePostSeo is not defined"
- The mutation hasn't been registered
- Add the mutation code to `functions.php`

### "Connection refused"
- Verify GraphQL URL is accessible
- Check if WPGraphQL plugin is active

### Slow performance
- Increase `delay_seconds` in config
- Reduce `batch.size`
- Check server resources

### Products not showing
- Install WPGraphQL WooCommerce plugin
- Verify products are published
- Check product visibility settings

## Rank Math Meta Keys

| Field | Meta Key |
|-------|----------|
| SEO Title | `rank_math_title` |
| Meta Description | `rank_math_description` |
| Focus Keyword | `rank_math_focus_keyword` |
| Canonical URL | `rank_math_canonical_url` |
| Robots | `rank_math_robots` |

## Related Files

- `skills/seo-wordpress-manager/SKILL.md` - Skill definition
- `skills/seo-wordpress-manager/reference.md` - Rank Math fields reference
- `skills/seo-wordpress-manager/config.example.json` - Config template
