# SEO WordPress Manager

Batch update Yoast SEO metadata via WordPress GraphQL API.

## Overview

This skill connects to your WordPress site via WPGraphQL and enables batch updates of:
- SEO titles
- Meta descriptions
- Focus keyphrases
- Open Graph metadata

## Prerequisites

### WordPress Setup

1. **Install WPGraphQL**
   ```
   Plugins → Add New → Search "WPGraphQL" → Install & Activate
   ```

2. **Install Yoast SEO** (if not already installed)
   ```
   Plugins → Add New → Search "Yoast SEO" → Install & Activate
   ```

3. **Install WPGraphQL for Yoast SEO**
   - Download from: https://github.com/developer-developer/wpgraphql-yoast-seo
   - Or search "WPGraphQL Yoast SEO" in plugins

4. **Enable Mutations** (add to `functions.php`):
   ```php
   // See skills/seo-wordpress-manager/reference.md for full code
   add_action('graphql_register_types', function() {
       register_graphql_mutation('updatePostSeo', [...]);
   });
   ```

5. **Create Application Password**
   - Users → Your Profile → Application Passwords
   - Name: "Claude SEO Manager"
   - Copy the generated password

### Configuration

Create `skills/seo-wordpress-manager/config.json`:

```json
{
  "wordpress": {
    "graphql_url": "https://your-site.com/graphql",
    "username": "your-username",
    "app_password": "xxxx xxxx xxxx xxxx"
  },
  "batch": {
    "size": 10,
    "delay_seconds": 1
  }
}
```

Or use environment variables:
```bash
WP_GRAPHQL_URL=https://your-site.com/graphql
WP_USERNAME=your-username
WP_APP_PASSWORD=xxxx xxxx xxxx xxxx
```

## Usage

### Via Claude (Recommended)

Simply describe what you want:

```
"Update meta descriptions for posts in the tutorials category"
"Find posts with SEO titles over 60 characters and fix them"
"Add focus keyphrases to posts that are missing them"
```

Claude will:
1. Run `analyze_seo.py` to fetch posts and identify SEO issues
2. Analyze each post's content and current SEO data
3. Generate optimized titles, descriptions, and keyphrases
4. Create a `changes.json` file with the improvements
5. Show you a preview of changes (before/after comparison)
6. Ask for confirmation
7. Apply changes in batches with progress tracking
8. Report results with success/failure counts

### Via Scripts (Direct)

```bash
# Test connection
python scripts/wp_graphql_client.py --action test

# Analyze posts for SEO issues
python scripts/analyze_seo.py --all --output analysis.json

# Analyze a specific category
python scripts/analyze_seo.py --category tutorials --output analysis.json

# Check focus keyphrases too
python scripts/analyze_seo.py --all --check-keyphrase --output analysis.json

# Preview changes (requires changes.json input - generated by Claude)
python scripts/preview_changes.py --input changes.json --validate

# Apply changes (dry-run by default)
python scripts/yoast_batch_updater.py --input changes.json

# Apply changes for real
python scripts/yoast_batch_updater.py --input changes.json --apply

# Resume interrupted batch
python scripts/yoast_batch_updater.py --resume
```

### The Workflow

```
┌─────────────────────────────────────────────────────────────────┐
│  1. ANALYZE                                                      │
│     analyze_seo.py → analysis.json                              │
│     (identifies issues: missing, too long, generic, etc.)       │
└────────────────────────────┬────────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  2. GENERATE (Claude)                                           │
│     Reads analysis.json → generates changes.json                │
│     (optimized titles, descriptions, keyphrases)                │
└────────────────────────────┬────────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  3. PREVIEW                                                      │
│     preview_changes.py → shows before/after                     │
│     (user reviews and confirms)                                 │
└────────────────────────────┬────────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  4. APPLY                                                        │
│     yoast_batch_updater.py --apply → WordPress                  │
│     (batch updates with progress tracking)                      │
└─────────────────────────────────────────────────────────────────┘
```

## Input Format

The batch updater expects a JSON file with this structure:

```json
{
  "updates": [
    {
      "post_id": 123,
      "post_title": "Original Post Title",
      "current": {
        "seo_title": "Old Title | Site Name",
        "meta_desc": "Old description",
        "focus_keyphrase": "old keyword"
      },
      "new": {
        "seo_title": "New Optimized Title | Site Name",
        "meta_desc": "New compelling description under 160 characters",
        "focus_keyphrase": "new focus keyword"
      }
    }
  ]
}
```

## Safety Features

| Feature | Description |
|---------|-------------|
| **Dry-run by default** | Always preview before applying |
| **Confirmation prompt** | Must type "yes" to apply live changes |
| **Progress tracking** | Resume interrupted batches |
| **Backups** | Original values saved before changes |
| **Rate limiting** | Configurable delay between requests |

## SEO Best Practices

### Title Optimization
- **Length**: 50-60 characters (truncated at ~60 in SERPs)
- **Structure**: `Primary Keyword - Secondary | Brand`
- **Front-load**: Important keywords at the beginning

### Meta Description
- **Length**: 150-160 characters
- **Include CTA**: "Learn", "Discover", "Get"
- **Include keyword**: Natural placement
- **Unique**: Every page needs a different description

### Focus Keyphrase
- One primary keyword per post
- Long-tail keywords often perform better
- Match search intent

## Troubleshooting

### "GraphQL request failed: 401"
- Check Application Password is correct
- Ensure username matches the WordPress user

### "GraphQL errors: updatePostSeo is not defined"
- The mutation hasn't been registered
- Add the mutation code to `functions.php`

### "Connection refused"
- Verify GraphQL URL is accessible
- Check if WPGraphQL plugin is active

### Slow performance
- Increase `delay_seconds` in config
- Reduce `batch.size`
- Check server resources

## Related Files

- `skills/seo-wordpress-manager/SKILL.md` - Skill definition
- `skills/seo-wordpress-manager/reference.md` - Yoast fields reference
- `skills/seo-wordpress-manager/config.example.json` - Config template
